# AWS

## EC2       

![image](https://user-images.githubusercontent.com/73632896/224479630-3666e517-cb01-41ae-9ff1-32bfb419db0c.png)


- EC2 is one of the most popular of AWS’ offering
- EC2 = **Elastic Compute Cloud** = Infrastructure as a Service
- It mainly consists in the capability of:
    - Renting virtual machines (EC2)
    - Storing data on virtual drives (EBS)
    - Distributing load across machines (ELB)
    - Scaling the services using an auto-scaling group (ASG)
- Knowing EC2 is fundamental to understand how the Cloud works


### EC2 sizing & configuration options

- Operating System (OS): **Linux, Windows or Mac OS**
- How much compute power & cores **(CPU)**
- How much random-access memory **(RAM)**
- How much storage space:
    - Network-attached (EBS & EFS)
    - hardware (EC2 Instance Store)
    - Network card: speed of the card, Public IP address
- Firewall rules: **security group**
- **Bootstrap script** (configure at first launch): **EC2 User Data**

### EC2 User Data

- It is possible to bootstrap our instances using an **EC2 User data** script.
- **bootstrapping** means launching commands when a machine starts
- That script is only **run once** at the instance **first start**
- EC2 user data is used to automate boot tasks such as:
    - Installing updates
    - Installing software
    - Downloading common files from the internet
    - Anything you can think of
- **The EC2 User Data Script runs with the root user**

### Hands-On:
  
- Launching an EC2 Instance running Linux
- We’ll be launching our first virtual server using the AWS Console
- We’ll get a first high-level approach to the various parameters
- We’ll see that our web server is launched using EC2 user data
- We’ll learn how to start / stop / terminate our instance.

Steps:
- **Create Instance:**

  ![image](https://user-images.githubusercontent.com/73632896/224480363-5c92674b-b29d-4f7d-8af9-8c5d641aea13.png)
- **Name of the instance and other tags values(optional):**

  ![image](https://user-images.githubusercontent.com/73632896/224480446-be36c60e-a161-4b12-825f-ca739605699d.png)
- **OS and Image Selection:**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480501-ab28f087-7f9a-483f-becd-f4fb49ce8e9b.png)
- **Instance Type: (here used tc.micro which is under free tier)**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480572-62b97fa3-aa8c-4ef1-b954-3ced1f9b5e8d.png)
- **Create Key Pair to connect to the instance.**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480615-6bfc9c17-755a-4de8-adf7-73617ad78689.png)
- **Network Setting - allow http connections from anywhere to see a html by webserver**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480646-a7acaeaf-97de-461a-88a0-1522c73be911.png)
- **Storage Volumes - select Delete on termination from advance settings (only for tutorial purpose)**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480692-87934502-c19c-4ce8-be45-c82930c667f7.png)
- **user-data:**
  ```
  #!/bin/bash
  # user data
  # install httpd (Linux 2 version)
  yum update -y
  yum install -y httpd
  systemctl start httpd
  systemctl enable httpd
  echo "<h1>Hello Shreenath from $(hostname -f)</h1>" > /var/www/html/index.html
  ```
  
  **Note: User data script only runs on a first startup.
  If we need this script to run on every restart
  we need to use below script:**
  
  ```
  Content-Type: multipart/mixed; boundary="//"
  MIME-Version: 1.0

  --//
  Content-Type: text/cloud-config; charset="us-ascii"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 7bit
  Content-Disposition: attachment; filename="cloud-config.txt"

  #cloud-config
  cloud_final_modules:
    - [scripts-user, always]

  --//
  Content-Type: text/x-shellscript; charset="us-ascii"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 7bit
  Content-Disposition: attachment; filename="userdata.txt"

  #!/bin/bash
  # user data
  # install httpd (Linux 2 version)
  yum update -y
  yum install -y httpd
  systemctl start httpd
  systemctl enable httpd
  echo "<h1>Hello Shreenath from $(hostname -f)</h1>" > /var/www/html/index.html
  --//--
  ```
