# AWS

## EC2       

![image](https://user-images.githubusercontent.com/73632896/224479630-3666e517-cb01-41ae-9ff1-32bfb419db0c.png)


- EC2 is one of the most popular of AWS’ offering
- EC2 = **Elastic Compute Cloud** = Infrastructure as a Service
- It mainly consists in the capability of:
    - Renting virtual machines (EC2)
    - Storing data on virtual drives (EBS)
    - Distributing load across machines (ELB)
    - Scaling the services using an auto-scaling group (ASG)
- Knowing EC2 is fundamental to understand how the Cloud works


### EC2 sizing & configuration options

- Operating System (OS): **Linux, Windows or Mac OS**
- How much compute power & cores **(CPU)**
- How much random-access memory **(RAM)**
- How much storage space:
    - Network-attached (EBS & EFS)
    - hardware (EC2 Instance Store)
    - Network card: speed of the card, Public IP address
- Firewall rules: **security group**
- **Bootstrap script** (configure at first launch): **EC2 User Data**

### EC2 User Data

- It is possible to bootstrap our instances using an **EC2 User data** script.
- **bootstrapping** means launching commands when a machine starts
- That script is only **run once** at the instance **first start**
- EC2 user data is used to automate boot tasks such as:
    - Installing updates
    - Installing software
    - Downloading common files from the internet
    - Anything you can think of
- **The EC2 User Data Script runs with the root user**

### Hands-On:
  
- Launching an EC2 Instance running Linux
- We’ll be launching our first virtual server using the AWS Console
- We’ll get a first high-level approach to the various parameters
- We’ll see that our web server is launched using EC2 user data
- We’ll learn how to start / stop / terminate our instance.

Steps:
- **Create Instance:**

  ![image](https://user-images.githubusercontent.com/73632896/224480363-5c92674b-b29d-4f7d-8af9-8c5d641aea13.png)
- **Name of the instance and other tags values(optional):**

  ![image](https://user-images.githubusercontent.com/73632896/224480446-be36c60e-a161-4b12-825f-ca739605699d.png)
- **OS and Image Selection:**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480501-ab28f087-7f9a-483f-becd-f4fb49ce8e9b.png)
- **Instance Type: (here used tc.micro which is under free tier)**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480572-62b97fa3-aa8c-4ef1-b954-3ced1f9b5e8d.png)
- **Create Key Pair to connect to the instance.**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480615-6bfc9c17-755a-4de8-adf7-73617ad78689.png)
- **Network Setting - allow http connections from anywhere to see a html by webserver**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480646-a7acaeaf-97de-461a-88a0-1522c73be911.png)
- **Storage Volumes - select Delete on termination from advance settings (only for tutorial purpose)**
        
  ![image](https://user-images.githubusercontent.com/73632896/224480692-87934502-c19c-4ce8-be45-c82930c667f7.png)
- **user-data:**
  ```
  #!/bin/bash
  # user data
  # install httpd (Linux 2 version)
  yum update -y
  yum install -y httpd
  systemctl start httpd
  systemctl enable httpd
  echo "<h1>Hello Shreenath from $(hostname -f)</h1>" > /var/www/html/index.html
  ```
  
  **Note: User data script only runs on a first startup.
  If we need this script to run on every restart
  we need to use below script:**
  
  ```
  Content-Type: multipart/mixed; boundary="//"
  MIME-Version: 1.0

  --//
  Content-Type: text/cloud-config; charset="us-ascii"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 7bit
  Content-Disposition: attachment; filename="cloud-config.txt"

  #cloud-config
  cloud_final_modules:
    - [scripts-user, always]

  --//
  Content-Type: text/x-shellscript; charset="us-ascii"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 7bit
  Content-Disposition: attachment; filename="userdata.txt"

  #!/bin/bash
  # user data
  # install httpd (Linux 2 version)
  yum update -y
  yum install -y httpd
  systemctl start httpd
  systemctl enable httpd
  echo "<h1>Hello Shreenath from $(hostname -f)</h1>" > /var/www/html/index.html
  --//--
  ```

### EC2 Instance Types - Overview

- You can use different types of EC2 instances that are optimised for different use cases (https://aws.amazon.com/ec2/instance-types/)

![image](https://user-images.githubusercontent.com/73632896/224661179-f137e0b7-02c3-43f4-a1a2-8450217426f9.png)

- AWS has the following naming convention:
  
  - **m5.2xlarge**
    - m: instance class
    - 5: generation (AWS improves them over time)
    - 2xlarge: size within the instance class

  #### EC2 Instance Types – General Purpose
 
  - Great for a diversity of workloads such as web servers or code repositories
 
  ![image](https://user-images.githubusercontent.com/73632896/224661864-e6d6b8cf-f299-43e8-9a9e-489f0b24e3e7.png)

  - Balance between:
    - Compute
    - Memory
    - Networking
  - Wwe will be using the t2.micro which is a General Purpose EC2 instance

  #### EC2 Instance Types – Compute Optimized

  - Great for compute-intensive tasks that require high performance processors:
    - Batch processing workloads
    - Media transcoding
    - High performance web serversHigh performance computing (HPC)
    - Scientific modeling & machine learning
    - Dedicated gaming servers
  
  ![image](https://user-images.githubusercontent.com/73632896/224662357-f2ad95e2-c218-4a8d-85e7-a534fe4e8821.png)
  
  #### EC2 Instance Types – Memory Optimized
  
  - Fast performance for workloads that process large data sets in memory
  - Use cases:
        - High performance, relational/non-relational databases
        - Distributed web scale cache stores
        - In-memory databases optimized for BI (business intelligence)
        - Applications performing real-time processing of big unstructured data

  ![image](https://user-images.githubusercontent.com/73632896/224662701-6175a884-1d7f-4b01-8670-2b274f6e14fc.png)
  
  #### EC2 Instance Types – Storage Optimized

  - Great for storage-intensive tasks that require high, sequential read and write access to large data sets on local storage
  - Use cases:
        - High frequency online transaction processing (OLTP) systems
        - Relational & NoSQL databases
        - Cache for in-memory databases (for example, Redis)
        - Data warehousing applications
        - Distributed file systems

  ![image](https://user-images.githubusercontent.com/73632896/224663105-1d3fa20b-9ec1-407a-8e04-279f0f5ec102.png)
  
  #### EC2 Instance Types: example
  
  ![image](https://user-images.githubusercontent.com/73632896/224663278-3a39ec7e-d0be-47ec-aec8-84418759760b.png)
  
  [See Website](https://instances.vantage.sh/)
  
### Introduction to Security Groups

- Security Groups are the fundamental of network security in AWS
- They control how traffic is allowed into or out of our EC2 Instances.

![image](https://user-images.githubusercontent.com/73632896/224663795-8c5e0f12-a9c8-47f7-8700-b24f6092977b.png)

- Security groups only contain **allow** rules
- Security groups rules can reference by IP or by security group

  #### Security Groups Deeper Dive
  - Security groups are acting as a “firewall” on EC2 instances
  - They regulate:
      - Access to Ports
      - Authorised IP ranges – IPv4 and IPv6
      - Control of inbound network (from other to the instance)
      - Control of outbound network (from the instance to other)
  
  ![image](https://user-images.githubusercontent.com/73632896/224664226-9f700b71-22f6-463d-8785-2a9b3f88f6d2.png)
  
  #### Security Groups Diagram
  ![image](https://user-images.githubusercontent.com/73632896/224665651-e4638d4f-27c9-435a-8270-75a816798f6b.png)
  
  #### Security Groups Good to know
  
  - Can be attached to multiple instances
  - Locked down to a region / VPC combination
  - Does live “outside” the EC2 – if traffic is blocked the EC2 instance won’t see it
  - It’s good to maintain one separate security group for SSH access
  - If your application is not accessible (time out), then it’s a security group issue
  - If your application gives a “connection refused“ error, then it’s an application error or it’s not launched
  - All inbound traffic is blocked by default
  - All outbound traffic is authorised by default

  #### Referencing other security groups Diagram

  ![image](https://user-images.githubusercontent.com/73632896/224664932-7d47277b-28fe-44ba-b556-f045b804f087.png)
  
  #### Classic Ports to know
  
  - 22 = SSH (Secure Shell) - log into a Linux instance
  - 21 = FTP (File Transfer Protocol) – upload files into a file share
  - 22 = SFTP (Secure File Transfer Protocol) – upload files using SSH
  - 80 = HTTP – access unsecured websites
  - 443 = HTTPS – access secured websites
  - 3389 = RDP (Remote Desktop Protocol) – log into a Windows instance

